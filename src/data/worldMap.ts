// src/data/worldMap.ts
import type { WorldMapDefinition, PointOfInterest } from '../engine/worldMapTypes';

const pointsOfInterest: PointOfInterest[] = [
  {
    id: 'poi_start',
    name: 'Tutorial A',
    description: 'Initial actions row 0,0.',
    type: 'biome',
    biomeId: 'random_wilds',
    tableauPresetId: 'initial_actions_00',
    rewards: [
      {
        id: 'tutorial-a-aspects',
        type: 'aspect-choice',
        amount: 3,
        drawCount: 3,
        chooseCount: 1,
        description: 'Choose 1: Lupus, Ursus, or Felis jumbo card aspect',
        options: ['lupus', 'ursus', 'felis'],
      },
    ],
    narration: {
      title: 'Awaken an {Aspect|orange}',
      body: 'You cannot progress through this physical world as just a {spirit}. Order the chaos ahead of you to unlock a physical aspect.',
      tone: 'teal',
      autoCloseOnDeparture: true,
    },
    sparkle: {
      proximityRange: 3,
      starCount: 6,
      glowColor: '#f7d24b',
      intensity: 1,
    },
  },
  {
    id: 'poi_initial_01',
    name: 'Tutorial B',
    description: 'Initial actions row 0,1.',
    type: 'biome',
    biomeId: 'random_wilds',
    tableauPresetId: 'initial_actions_01',
    rewards: [
      {
        id: 'tutorial-b-orim',
        type: 'orim-choice',
        amount: 1,
        drawCount: 3,
        chooseCount: 1,
        description: 'Choose 1 orim to enhance your cards.',
        options: ['orim_vigor', 'orim_swiftness', 'orim_brilliance'],
      },
    ],
    sparkle: {
      proximityRange: 3,
      starCount: 6,
      glowColor: '#f7d24b',
      intensity: 1,
    },
  },
  {
    id: 'poi_initial_02',
    name: 'Tutorial C',
    description: 'Initial actions row 0,2.',
    type: 'biome',
    biomeId: 'random_wilds',
    tableauPresetId: 'initial_actions_02',
    rewards: [
      {
        id: 'tutorial-c-aspects',
        type: 'aspect-choice',
        amount: 3,
        drawCount: 3,
        chooseCount: 1,
        description: 'Choose 1: Lupus, Ursus, or Felis jumbo card aspect',
        options: ['lupus', 'ursus', 'felis'],
      },
    ],
    narration: {
      title: 'Awaken an {Aspect|orange}',
      body: 'You cannot progress through this physical world as just a {spirit}. Order the chaos ahead of you to unlock a physical aspect.',
      tone: 'teal',
      autoCloseOnDeparture: true,
    },
    sparkle: {
      proximityRange: 3,
      starCount: 6,
      glowColor: '#f7d24b',
      intensity: 1,
    },
  },
  {
    id: 'poi_oasis_a',
    name: 'Oasis A',
    description: 'Tutorial oasis that introduces sequencing and golf transitions.',
    type: 'biome',
    biomeId: 'random_wilds',
    tableauPresetId: 'oasis_a_tutorial',
  },
  {
    id: 'poi_battle_arena',
    name: 'Goblin Outpost',
    description: 'A goblin stands guard. A battle is imminent.',
    type: 'biome',
    biomeId: 'battle_biome',
  },
  {
    id: 'poi_supply_cache',
    name: 'Hidden Satchel',
    description: 'You found a satchel of supplies!',
    type: 'biome',
    biomeId: 'supply_cache_biome',
  },
  {
    id: 'poi_random_wilds',
    name: 'Whispering Wilds',
    description: 'An untamed wilderness stretches before you.',
    type: 'biome',
    biomeId: 'random_wilds',
  },
  {
    id: 'poi_event_glade_test',
    name: 'Peaceful Glade',
    description: 'A sun-dappled clearing. Something stirs here.',
    type: 'biome',
    biomeId: 'event_peaceful_glade',
    sparkle: {
      proximityRange: 3,
      starCount: 5,
      glowColor: '#a8e6a3',
      intensity: 0.8,
    },
  },
  {
    id: 'poi_empty',
    name: 'Empty Field',
    description: 'There is nothing of interest here.',
    type: 'empty',
  },
];

const poiLookup = new Map(pointsOfInterest.map((poi) => [poi.id ?? '', poi]));

export const mainWorldMap: WorldMapDefinition = {
  id: 'main_world',
  name: 'Exploritaire World',
  size: { cols: 11, rows: 11 },
  defaultSpawnPosition: { col: 0, row: 2 },
  tutorialRail: {
    path: [
      { col: 0, row: 2 },
      { col: 0, row: 1 },
      { col: 0, row: 0 },
    ],
    lockUntilPathComplete: true,
    label: 'Tutorial Path',
  },
  pointsOfInterest,
  cells: [
    { gridPosition: { col: 0, row: 0 }, traversalDifficulty: 1, poi: poiLookup.get('poi_initial_02') },
    { gridPosition: { col: 0, row: 1 }, traversalDifficulty: 1, poi: poiLookup.get('poi_initial_01') },
    { gridPosition: { col: 0, row: 2 }, traversalDifficulty: 1, poi: poiLookup.get('poi_start') },
    { gridPosition: { col: 0, row: -2 }, traversalDifficulty: 1, poi: poiLookup.get('poi_oasis_a') },
    { gridPosition: { col: 1, row: 0 }, traversalDifficulty: 2, poi: poiLookup.get('poi_random_wilds') },
    { gridPosition: { col: 1, row: 2 }, traversalDifficulty: 1, poi: poiLookup.get('poi_event_glade_test') },
  ],
  blockedCells: [
    {
      gridPosition: { col: -2, row: 0 },
      reason: 'Canyon wall',
      terrain: 'canyon',
      lightBlocker: { castHeight: 5, softness: 4 },
    },
    {
      gridPosition: { col: -1, row: 0 },
      reason: 'Canyon wall',
      terrain: 'canyon',
      lightBlocker: { castHeight: 5, softness: 4 },
    },
    {
      gridPosition: { col: 1, row: 0 },
      reason: 'Canyon wall',
      terrain: 'canyon',
      lightBlocker: { castHeight: 5, softness: 4 },
    },
    {
      gridPosition: { col: 2, row: 0 },
      reason: 'Canyon wall',
      terrain: 'canyon',
      lightBlocker: { castHeight: 5, softness: 4 },
    },
    {
      gridPosition: { col: -2, row: 1 },
      reason: 'Mountain pass',
      terrain: 'mountain',
      lightBlocker: { castHeight: 8, softness: 6 },
    },
    {
      gridPosition: { col: -1, row: 1 },
      reason: 'Mountain pass',
      terrain: 'mountain',
      lightBlocker: { castHeight: 8, softness: 6 },
    },
    {
      gridPosition: { col: 1, row: 1 },
      reason: 'Mountain pass',
      terrain: 'mountain',
      lightBlocker: { castHeight: 8, softness: 6 },
    },
    {
      gridPosition: { col: 2, row: 1 },
      reason: 'Mountain pass',
      terrain: 'mountain',
      lightBlocker: { castHeight: 8, softness: 6 },
    },
    {
      gridPosition: { col: -2, row: 2 },
      reason: 'Canyon wall',
      terrain: 'canyon',
      lightBlocker: { castHeight: 5, softness: 4 },
    },
    {
      gridPosition: { col: -1, row: 2 },
      reason: 'Canyon wall',
      terrain: 'canyon',
      lightBlocker: { castHeight: 5, softness: 4 },
    },
    {
      gridPosition: { col: 1, row: 2 },
      reason: 'Canyon wall',
      terrain: 'canyon',
      lightBlocker: { castHeight: 5, softness: 4 },
    },
    {
      gridPosition: { col: 2, row: 2 },
      reason: 'Canyon wall',
      terrain: 'canyon',
      lightBlocker: { castHeight: 5, softness: 4 },
    },
    {
      gridPosition: { col: -2, row: 3 },
      reason: 'Mountain ridge',
      terrain: 'mountain',
      lightBlocker: { castHeight: 9, softness: 7 },
    },
    {
      gridPosition: { col: -1, row: 3 },
      reason: 'Mountain ridge',
      terrain: 'mountain',
      lightBlocker: { castHeight: 9, softness: 7 },
    },
    {
      gridPosition: { col: 0, row: 3 },
      reason: 'Mountain ridge',
      terrain: 'mountain',
      lightBlocker: { castHeight: 9, softness: 7 },
    },
    {
      gridPosition: { col: 1, row: 3 },
      reason: 'Mountain ridge',
      terrain: 'mountain',
      lightBlocker: { castHeight: 9, softness: 7 },
    },
    {
      gridPosition: { col: 2, row: 3 },
      reason: 'Mountain ridge',
      terrain: 'mountain',
      lightBlocker: { castHeight: 9, softness: 7 },
    },
  ],
  blockedEdges: [
    { from: { col: 0, row: 0 }, to: { col: 0, row: -1 }, reason: 'Collapsed bridge' },
  ],
  conditionalEdges: [
    { from: { col: 0, row: 2 }, to: { col: 0, row: 1 }, requirement: 'source_tableau_cleared', reason: 'Clear tableau at 0,2 first' },
    { from: { col: 0, row: 1 }, to: { col: 0, row: 0 }, requirement: 'source_tableau_cleared', reason: 'Clear tableau at 0,1 first' },
  ],
};
